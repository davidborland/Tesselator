<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>Tesselator</title>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
</head>

<body>

<div class="jumbotron text-center">
  <h1>Tesselator</h1>
</div>

<div class="container-fluid text-center">
  <div class="row">
    <div id="controls" class="col-2">
      <h3>Controls</h3>
      <div class="form-group text-left">
        <label for="shapeSelect">Shape</label>
        <select class="form-control" id="shapeSelect">
          <option value="triangle">Triangle</option>
          <option value="square">Square</option>
          <option value="hexagon">Hexagon</option>
        </select>
      </div>
    </div>
    <div id="edit" class="col-5">
      <h3>Edit</h3>
      <svg></svg>
      <h3>Vertices</h3>
      <div id="vertices" class="text-left"></div>
    </div>
    <div id="tile" class="col-5">
      <h3>Tesselation</h3>
      <svg></svg>
    </div>
  </div>
  <div class="text-right small">
    <div>Author: David Borland, RENCI, UNC-Chapel Hill</div>
    <div><a href="https://github.com/davidborland/Tesselator">GitHub repository</a></div>
  </div>
</div>

<script type="text/javascript">

// Shape select
d3.select("#shapeSelect").on("change", () => {
  switch (d3.event.target.value) {
    case "triangle":
      shape = newTriangle();
      update();
      break;

    case "square":
      shape = newSquare();
      update();
      break;

    case "hexagon":
      shape = newHexagon();
      update();
      break;
  }
  console.log(d3.event.target.value);
});

// The current svg size
let size = getWidth();

let svgEdit = d3.select("#edit").select("svg")
    .attr("width", size)
    .attr("height", size);

svgEdit.append("g")
    .attr("transform", "translate(" + size / 2 + "," + size / 2 + ")scale(1,-1)");

let svgTile = d3.select("#tile").select("svg")
    .attr("width", size)
    .attr("height", size);

svgTile.append("g")
    .attr("transform", "translate(" + size / 2 + "," + size / 2 + ")");

// The current shape
let shape = newTriangle();

// Initial update
update();

function update() {
  updateEdit();
  updateTile();
  updateVertices();
}

function updateEdit() {
  let g = svgEdit.select("g");

  let point = g.selectAll(".point")
      .data(shape.vertices);

  point.enter().append("circle")
      .attr("class", "point")
    .merge(point)
      .attr("cx", d => d.x)
      .attr("cy", d => d.y)
      .attr("r", 3)
      .style("fill", "white")
      .style("stroke", "black");
      
  point.exit().remove();


}

function updateTile() {

}

function updateVertices() {
  let vertex = d3.select("#vertices").selectAll("p")
      .data(shape.vertices);

  vertex.enter().append("p").merge(vertex)
      .text(vertexText);

  vertex.exit().remove();

  function vertexText(d, i) {
    return "Vertex " + i + ": " + Math.round(d.x) + ", " + Math.round(d.y);
  }
}

function newTriangle() {
  let s = size / 20;
  let a = 30 * Math.PI / 180;
  let x = Math.cos(a) * s;
  let y = Math.sin(a) * s;

  let vertices = [
    { x: 0, y: s },
    { x: x, y: -y },
    { x: -x, y: -y }
  ];

  return {
    vertices: vertices,
    lines: d3.pairs(vertices.concat(vertices[0]))
  };
}

function newSquare() {
  let s = size / 20;

  let vertices = [
    { x: -s, y: s },
    { x: s, y: s },
    { x: s, y: -s },
    { x: -s, y: -s }
  ];

  return {
    vertices: vertices,
    lines: d3.pairs(vertices.concat(vertices[0]))
  };
}

function newHexagon() {
  return [];
}

function getWidth() {
  return d3.select("#edit").node().clientWidth;
}

</script>

</body>
</html>
